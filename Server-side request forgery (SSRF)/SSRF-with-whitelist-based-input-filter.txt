This lab has a stock check feature which fetches data from an internal system.

To solve the lab, change the stock check URL to access the admin interface at http://localhost/admin and delete the user carlos.

The developer has deployed an anti-SSRF defense you will need to bypass.

1. Wchodzimy na stronę z zadaniem i uruchamiamy burpa, wybieramy jakaś kategorię, włączamy intercepta, klikamy check stock, przechwycone połączenie wysyłamy do repetera i wyłączamy intercepta
2. Zaznaczamy wszystko w stockapi i klikamy ctrl+shift+u aby zdekodować url. Pierwsze co robimy to staramy się dostać do localhosta czyli zamiast tego wpisujeny http://localhost/ klikamy send i otrzymujemy error z powiadomieniem, że host musi miec stock.weliketoshop.com
3. Musimy dojść do tego sposobem, skoro wiemy, że localhost nie działa jak również wpisywanie 127.1, próbujemy zataem wpisać http://username#@stock.weliketoshop.com klikamy send i otrzymujemy powiadomienie, że w linku musi być weliketoshop.com dzieje się tak dlatego, że po # wszystko jest traktowane jak komentarz a nie jak link
4. Zaznaczamy # i robimy ctrl+u dwa razy, klikamy send i otrzymujemy powiadomienie, że nie możemy się połączy do stock serwisa. Teraz zamiast username wpisujemy localhost. Klikamy send i otrzymujemy 200 ok
5. W response możemy kliknąć render i widzimy admin panel, teraz szukamy w response linijki i wpisujemy admin, widzimy żeby dostaćsię do amina należy dodać /admin 
6. Do naszej linijki dopisujemy /admin i klikamy send, klikając render widzimy, że jesteśmy w admin panelu i widzimy użytkowników, w response wpisujemy użytkownika, którego chcemy usunąć w tym wypadku carlosa, widzimy, że scieżka to /admin/delete?username=carlos
7. Dopisujemy tą linijkę do naszej linijki, klikamy send i zadanie w teorii jest zakończone, ale aby być pewnym wracamy do linijki http://localhost%2523@stock.weliketoshop.com/admin klikamy send i w render obserwujemy czy użytkownik carlos jest w systemie czy nie, w zadaniu go nie ma.

ENG:

1.Visit a product, click "Check stock", intercept the request in Burp Suite, and send it to Burp Repeater.
2.Change the URL in the stockApi parameter to http://127.0.0.1/ and observe that the application is parsing the URL, extracting the hostname, and validating it against a whitelist.
3.Change the URL to http://username@stock.weliketoshop.net/ and observe that this is accepted, indicating that the URL parser supports embedded credentials.
4.Append a # to the username and observe that the URL is now rejected.
5.Double-URL encode the # to %2523 and observe the extremely suspicious "Internal Server Error" response, indicating that the server may have attempted to connect to "username".
6.To access the admin interface and delete the target user, change the URL to:
http://localhost:80%2523@stock.weliketoshop.net/admin/delete?username=carlos