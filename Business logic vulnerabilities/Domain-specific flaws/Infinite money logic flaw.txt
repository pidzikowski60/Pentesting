This lab has a logic flaw in its purchasing workflow. To solve the lab, exploit this flaw to buy a "Lightweight l33t leather jacket".

You can log in to your own account using the following credentials: wiener:peter

1. Włączamy zadanie ze strony, uruchamiamy burpa, klikamy my account i wpisujemy dane podane w zadaniu, mamy 100 kredytów, klikamy w home
2. Klikamy Gift card i schodzimy w dół i klikamy add to cart, wchodzimy do koszyka i widzimy, że został dodany, wracamy do home i na dole uzupełniamy dane do newslettera 
3. Otrzymujemy kupon signup30, w koszyku wpisujemy kupon signup30 i klikamy apply, klikamy place order, kopiujemy gift card code i zapisujey gdzieś na boku, teraz klikamy my account i wpisujemy w gift card nasz skopiowany kod i kliknij redeem
4. Wchodzimy w burpa następnie wchodzimy w project options w sesion handling rules klikamy add, otiweramy scope klikamy include all urls, w detalach w rule action, klikamy run a macro, w select macro klikamy add i szukamy:

POST Url:/gift-card
POST Url:/cart 
POST Url:/cart/coupon 
POST Url:/cart/checkout 
GET Url:/cart/order-confirmation?order

Zaznaczamy wszystkie przez trzymanie ctrl i klikanie w nie i klikamy w ok, w macro editor klikamy w jedynego geta jakiego mamy, następnie wybieramy configurate item , klikamy add, w parameter name wpisujemy gift-card, w tekście zjeżdżamy na dół i zaznaczamy kod naszej karty, klikamy ok i w macro editor konfigurujemy post url/gift-card i w parameter handling w gift card wybierz opcje derive from prior response, klikamy ok, w macro editor klikamy test macro, jeżeli otrzymaliśmy 200 ok w jedynym naszym get oraz 302 w gift-card znaczy, że wszystko ustawiliśmy dobrze, możemy zauważyć, że po kliknięciu  w gift-card utworzony został nowy kod, klikamy ok aż do zakmnięcia makra
5. Wchodzimy teraz w http history i szukamy GET URL:/my-account  ,wysyłamy to polączenie do intrudera, czyścimy wszysko, wybieramy atak snajpera, wybieramy typ null payloads, i ustawiamy w generowaniu liczbę 412(tyle jest potrzebne by bylo nas stać na kurtkę) i zaczynamy atak
6. Możemy odświeżyć nasze konto na przeglądarce i możemy zaobserwować, że nasze konto jest zasilane środkami cały czas, kontynujemy do momentu, aż będziemy mieli wystarczające środki na zakup kurtki 
7. Po zakończonym ataku, wchodzimy w home, dodajemy kurtkę do koszyka i klikamy place order




ENG:

This solution uses Burp Intruder to automate the process of buying and redeeming gift cards. Users proficient in Python might prefer to use the Turbo Intruder extension instead.

1.With Burp running, log in and sign up for the newsletter to obtain a coupon code, SIGNUP30. Notice that you can buy $10 gift cards and redeem them from the "My account" page.
2.Add a gift card to your basket and proceed to the checkout. Apply the coupon code to get a 30% discount. Complete the order and copy the gift card code to your clipboard.
3.Go to your account page and redeem the gift card. Observe that this entire process has added $3 to your store credit. Now you need to try and automate this process.
4.Study the proxy history and notice that you redeem your gift card by supplying the code in the gift-card parameter of the POST /gift-card request.
5.5Go to "Project options" > "Sessions". In the "Session handling rules" panel, click "Add". The "Session handling rule editor" dialog opens.
6.In the dialog, go to the "Scope" tab. Under "URL Scope", select "Include all URLs".
7.Go back to the "Details" tab. Under "Rule actions", click "Add" > "Run a macro". Under "Select macro", click "Add" again to open the Macro Recorder.
8.Select the following sequence of requests:

POST /cart
POST /cart/coupon
POST /cart/checkout
GET /cart/order-confirmation?order-confirmed=true
POST /gift-card
Then, click "OK". The Macro Editor opens.

9.In the list of requests, select GET /cart/order-confirmation?order-confirmed=true. Click "Configure item". In the dialog that opens, click "Add" to create a custom parameter. Name the parameter gift-card and highlight the gift card code at the bottom of the response. Click "OK" twice to go back to the Macro Editor.
10.Select the POST /gift-card request and click "Configure item" again. In the "Parameter handling" section, use the drop-down menus to specify that the gift-card parameter should be derived from the prior response (response 4). Click "OK".
11.In the Macro Editor, click "Test macro". Look at the response to GET /cart/order-confirmation?order-confirmation=true and note the gift card code that was generated. Look at the POST /gift-card request. Make sure that the gift-card parameter matches and confirm that it received a 302 response. Keep clicking "OK" until you get back to the main Burp window.
12.Send the GET /my-account request to Burp Intruder. Use the "Sniper" attack type and clear the default payload positions.
13.On the "Payloads" tab, select the payload type "Null payloads". Under "Payload settings", choose to generate 412 payloads.
14.Go to the "Resource pool" tab and add the attack to a resource pool with the "Maximum concurrent requests" set to 1. Start the attack.
15.When the attack finishes, you will have enough store credit to buy the jacket and solve the lab.