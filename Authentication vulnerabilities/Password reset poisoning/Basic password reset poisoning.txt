This lab is vulnerable to password reset poisoning. The user carlos will carelessly click on any links in emails that he receives. To solve the lab, log in to Carlos's account.

You can log in to your own account using the following credentials: wiener:peter. Any emails sent to this account can be read via the email client on the exploit server.



1.Wchodzimy na strone, uruchamiamy burpa, klikamy na forgot password i wpisujemy wiener
2. Wchodzimy do exploit server i kilkamy na email client, otrzymaliśmy maila z linkiem, klikamy linka, tera możemy zresetować hasło, używamy tego samego peter i peter
3. Wchodzimy w http history, szukamy POST URL:/forgot-password, wysyłamy tego requesta do repetera
4. W repeterze zamieniamy hosta na np abcd1234, klikamy send i dostajemy 200 ok, w email client otrzymaliśmy nowy link z host headerem abcd1234
5. W repeterze, zmieniamy teraz hosta na url w exploit serverze czyli w repeterze powinno być Host : ac0f1f131ebd7e0280931e3e011a0068.web-security-academy.net, zmienamy username z wiener na carlos i klikamy send
6. Wchodzimy w access log i szukamy innego ip, kopiujemy tokena i zapisujemy go obok.
7. Wchodzimy w email client i kopiujemy pierwszy link jaki dostaliśmy, otwieramy nową karte wklejamy ten link i podmieniamy token na ten, który zapisaliśmy,
8. Otwiera nam się strona ze zmianą hasła, zmieniamy hasło na jakie chcemy np peter.
9. Logujemy się na stronie z użytkownikiem carlos i hasło peter



ENG:


1.Go to the login page and notice the "Forgot your password?" functionality. Request a password reset for your own account.
2.Go to the exploit server and open the email client. Observe that you have received an email containing a link to reset your password. Notice that the URL contains the query parameter temp-forgot-password-token.
3.Click the link and observe that you are prompted to enter a new password. Reset your password to whatever you want.
4.In Burp, study the HTTP history. Notice that the POST /forgot-password request is used to trigger the password reset email. This contains the username whose password is being reset as a body parameter. Send this request to Burp Repeater.
5.In Burp Repeater, observe that you can change the Host header to an arbitrary value and still successfully trigger a password reset. Go back to the email server and look at the new email that you've received. Notice that the URL in the email contains your arbitrary Host header instead of the usual domain name.
6.Back in Burp Repeater, change the Host header to your exploit server's domain name (YOUR-EXPLOIT-SERVER-ID.exploit-server.net) and change the username parameter to carlos. Send the request.
7.Go to your exploit server and open the access log. You will see a request for GET /forgot-password with the temp-forgot-password-token parameter containing Carlos's password reset token. Make a note of this token.
8.Go to your email client and copy the genuine password reset URL from your first email. Visit this URL in the browser, but replace your reset token with the one you obtained from the access log.
9.Change Carlos's password to whatever you want, then log in as carlos to solve the lab.